name: Make new Sweyer release
on: 
  workflow_dispatch:
    inputs:
      skip-tests:
        description: Skip tests (not recommended)
        type: boolean
        default: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: üìö Git Checkout
        uses: actions/checkout@v3

      - name: üèó Build and test Sweyer
        if: ${{ github.event.inputs.skip-tests == 'false' }}
        uses: ./.github/workflows/build_and_test
        with:
          testing_arguments: --coverage

      - name: ‚òÇ Upload Code Coverage
        if: ${{ github.event.inputs.skip-tests == 'false' }}
        uses: codecov/codecov-action@v3

      - name: üöÄü§ñ Bundle and deploy to Google Play
        uses: ./.github/workflows/deploy_google_play
        with:
          secrets_ANDROID_KEYSTORE_FILE: ${{ secrets.ANDROID_KEYSTORE_FILE }}
          secrets_ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
          secrets_ANDROID_KEY_PASSWORD: ${{ secrets.ANDROID_KEY_PASSWORD }}
          secrets_ANDROID_KEY_ALIAS: ${{ secrets.ANDROID_KEY_ALIAS }}
          secrets_GPLAY_FASTLANE_SERVICE_ACCOUNT_KEY_JSON: ${{ secrets.GPLAY_FASTLANE_SERVICE_ACCOUNT_KEY_JSON }}
